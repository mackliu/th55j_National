# CLAUDE.md

本文件為 Claude Code (claude.ai/code) 在此存儲庫中工作時提供指導。

## 專案概述

這是一個基於 PHP 的大眾運輸查詢系統，用於第 55 屆全國技能競賽。系統讓使用者能夠透過網頁介面查詢公車路線、站點和即時公車資訊。

## 架構

### 前端結構
- **index.php**: 主要使用者介面，包含路線選擇和互動式路線圖
- **form.php**: 使用者意見反饋的調查表單
- **login.php**: 管理員登入頁面（含驗證碼）
- **admin.php**: 系統管理的管理員儀表板

### 後端結構
- **api/**: 包含所有資料操作的 API 端點
  - `db.php`: 資料庫連接和工具函數
  - `get_*.php`: 資料查詢 API
  - `add_*.php`: 資料新增 API
  - `edit_*.php`: 資料更新 API
  - `del.php`: 通用刪除 API
- **pages/**: 管理員介面的 CRUD 操作頁面
- **css/**: Bootstrap 和自訂樣式
- **js/**: jQuery、Bootstrap 和自訂 JavaScript

### 資料庫結構
- **admin**: 管理員帳號資料
- **bus**: 公車資訊（車牌號碼、路線、班表）
- **route**: 路線定義和名稱
- **station**: 站點資訊和位置
- **route_station**: 連接路線和站點的關聯表（含順序）
- **survey**: 使用者調查回應

## 開發流程

### 資料庫連接
系統使用 PDO 連接 MySQL。資料庫設定在 `api/db.php` 中：
- 資料庫名稱：`th55j_national`
- 預設帳號密碼：root/mack1007
- 包含快速 SQL 執行的工具函數 `q($sql)`

### 分支策略
- **main**: 前端使用左右視窗選擇路線站點
- **page**: 使用核取方塊選擇，透過 include 切換頁面
- **route**: 使用核取方塊選擇，透過 JavaScript 切換頁面
- **目前分支**: page

### 開發順序
1. 站點管理（需先建立站點）
2. 路線管理（需要 2 個以上站點）
3. 車輛管理（需要路線資料）
4. 調查管理（需要路線資料）

## API 端點

### 公開 API
- `get_routes.php`: 取得所有路線（用於下拉選單）
- `get_route_stations.php`: 取得特定路線的站點
- `get_bus.php`: 取得公車資訊（用於滑鼠停留顯示，需要 route_id + station_id）
- `feeback.php`: 處理調查表單提交

### 管理 API
- `get_stations.php`: 取得所有站點（可選擇性依路線過濾）
- `get_bus_list.php`: 取得所有公車（用於管理員列表）
- `del.php`: 刪除記錄（需要資料表名稱和 id）
- `add_*.php`: 新增記錄
- `edit_*.php`: 更新現有記錄

## 主要功能

### 路線視覺化
- 互動式 SVG 路線圖，包含站點標示
- 根據站點布局動態繪製路徑
- 滑鼠停留顯示公車資訊功能
- 可設定每列站點數量（預設：3）

### 管理介面
- 完整的站點、路線和公車 CRUD 操作
- 調查回應管理
- 基於時間的表單設定

## 資料庫設定

匯入 `th55j_national.sql` 以建立資料庫結構和初始資料。

## 無建置流程

這是一個傳統的 PHP 應用程式，沒有建置、測試或 lint 指令。開發是直接在伺服器上進行，檔案變更立即生效。